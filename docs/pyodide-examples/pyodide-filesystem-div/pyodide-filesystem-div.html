<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jinja2 with Pyodide Example</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js"></script>
</head>
<body>
    <h1>Jinja2 with Pyodide Example</h1>
    <pre id="output"></pre>

    <script type="text/javascript">
        async function main() {
            // Load Pyodide
            let pyodide = await loadPyodide();
            await pyodide.loadPackage("jinja2");

            // Fetch the Python script from the _static directory
            const response = await fetch("process_template.py");
            const scriptText = await response.text();

            // Write the script to Pyodide's virtual file system
            pyodide.FS.writeFile("/process_template.py", scriptText);

            // Capture the output by redirecting stdout
            pyodide.runPython(`
import sys
import io
sys.stdout = io.StringIO()

# Run the script
import sys
sys.path.insert(0, "/")
import process_template

# Get the output
output = sys.stdout.getvalue()
output
            `);

            // Get the Python output
            let output = pyodide.runPython('output');

            // Display the output in the HTML page
            document.getElementById("output").textContent = output;
        }

        main();
    </script>
</body>
</html>
