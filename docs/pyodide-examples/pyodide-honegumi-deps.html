<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jinja2 with Pyodide and Pydantic Example</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>
</head>
<body>
    <h1>Jinja2 with Pyodide and Pydantic Example</h1>
    <pre id="output"></pre>

    <script type="text/javascript">
        async function main() {
            let pyodide = await loadPyodide();
            await pyodide.loadPackage(["micropip", "jinja2", "pydantic", "pandas"]);
            const micropip = pyodide.pyimport("micropip");
            await micropip.install(["black", "jupytext"]);

            const code = `
import random
import jupytext
from jinja2 import Template
from pydantic import BaseModel, ValidationError

# Define the Pydantic model
class DataModel(BaseModel):
    min_value: int
    max_value: int

# Define the Jinja2 template as a string
template_str = """
# This is a generated Python script
import random

# Generate a random number between {{ min_value }} and {{ max_value }}
random_number = random.randint({{ min_value }}, {{ max_value }})
print("Random number:", random_number)
"""

# Create a Jinja2 Template object
template = Template(template_str)

# Define the data to be validated and rendered
data = {
    'min_value': 1,
    'max_value': 10,
}

# Validate the data using Pydantic
try:
    validated_data = DataModel(**data)
    # Render the template with the validated data
    rendered_script = template.render(validated_data.dict())
    # Execute the rendered script and capture the output
    exec(rendered_script)
except ValidationError as e:
    print("Validation error:", e)
            `;

            // Run the Python code and capture the output
            let output = pyodide.runPython(code);
            document.getElementById("output").textContent = output;
        }

        main();
    </script>
</body>
</html>
